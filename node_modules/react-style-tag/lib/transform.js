'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.prefixCss = exports.minify = exports.getTransformedCss = exports.getCoalescedPropsValue = undefined;

var _autoprefixer = require('autoprefixer');

var _autoprefixer2 = _interopRequireDefault(_autoprefixer);

var _isUndefined = require('lodash/isUndefined');

var _isUndefined2 = _interopRequireDefault(_isUndefined);

var _postcss = require('postcss');

var _postcss2 = _interopRequireDefault(_postcss);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var prefixer = (0, _postcss2.default)([(0, _autoprefixer2.default)({
  remove: false
})]);

/**
 * return the propsValue if it exists, else return the defaultValue
 *
 * @param {boolean} propsValue
 * @param {boolean} defaultValue
 * @returns {boolean}
 */
// external dependencies
var getCoalescedPropsValue = function getCoalescedPropsValue(propsValue, defaultValue) {
  if ((0, _isUndefined2.default)(propsValue)) {
    return defaultValue;
  }

  return propsValue;
};

/**
 * return the minified string css
 *
 * @param {string} cssText
 * @returns {string}
 */
var minify = function minify(cssText) {
  return cssText.trim().replace(/\/\*[\s\S]+?\*\//g, '').replace(/[\n\r]/g, '').replace(/\s*([:;,{}])\s*/g, '$1').replace(/\s+/g, ' ').replace(/;}/g, '}').replace(/\s+(!important)/g, '$1').replace(/#([a-fA-F0-9])\1([a-fA-F0-9])\2([a-fA-F0-9])\3(?![a-fA-F0-9])/g, '#$1$2$3').replace(/(Microsoft[^;}]*)#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])(?![a-fA-F0-9])/g, '$1#$2$2$3$3$4$4').replace(/\b(\d+[a-z]{2}) \1 \1 \1/gi, '$1').replace(/\b(\d+[a-z]{2}) (\d+[a-z]{2}) \1 \2/gi, '$1 $2').replace(/([\s|:])[0]+px/g, '$10');
};

/**
 * return the css after running through autoprefixer
 *
 * @param {string} cssText
 * @returns {string}
 */
var prefixCss = function prefixCss(cssText) {
  return prefixer.process(cssText).css;
};

/**
 * get the (if applicable) prefixed and minified css based on the
 * original cssText
 *
 * @param {string} cssText
 * @param {boolean} doNotPrefix=false
 * @param {boolean} isMinified=false
 * @returns {string}
 */
var getTransformedCss = function getTransformedCss(cssText) {
  var doNotPrefix = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : false;
  var isMinified = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;

  var transformedCss = doNotPrefix ? cssText : prefixCss(cssText);

  return isMinified ? minify(transformedCss) : transformedCss;
};

exports.getCoalescedPropsValue = getCoalescedPropsValue;
exports.getTransformedCss = getTransformedCss;
exports.minify = minify;
exports.prefixCss = prefixCss;